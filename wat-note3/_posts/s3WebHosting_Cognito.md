---
title: 'S3静的ホスティングサイト + Cognito認証'
excerpt: 'S3での静的Webホスティングで立てたサイトにCognitoによる認証を付ける'
coverImage: ''
date: '2023-02-14T23:03:11.000Z'
updatedAt: '2023-02-14T23:03:11.000Z'
tag: ["AWS","S3","Cognito"]
author:
  name: Tatsuroh Wakasugi
  picture: '/assets/blog/authors/WAT.jpg'
ogImage:
  url: ''
---

前述の S3の静的Webサイトホスティング で立てたWebサイトに、 また前述のCognito による認証を付け加えて、限られたユーザしか閲覧できないようにする。

# 大まかな流れ

# S3による静的Webサイトホスティング

こちらは前述の記事を参照されたし。
ここでは割愛する。

# Cognito

次に認証基盤となる、Cognitoの設定を行う。

## ユーザープールの作成

まずは閲覧できるユーザーの管理を行うユーザープールを作成する。
今回は、ユーザーの登録は管理側で行うものとし、サイナップは行えないようにする。

- cognitoコンソールへ行く
- まずは「ユーザープールの作成」へ
- プロバイダーのタイプは「Cognitoユーザープール」で、サインインオプションはユーザー名だけにしておく、とりあえず
- ユーザー名の要件も任意のユーザー名でサインインすることを許可、大文字小文字区別にチェック入れる
- 次はステップ２のセキュリティ要件
- パスワードポリシーはCognitoのデフォルト
- MFAはなしでいい
- ユーザアカウントの復旧はとりあえず　セルフサービスのアカウントの復旧を有効化　にしておく
- 次はステップ３　サインアップエクスペリエンス
- セルフサービスのサインアップ　で自己登録の有効化　をつける　→ これ **"管理者のみにユーザーの作成を許可する"** がいいのでは
- 属性検証とユーザーアカウントの確認　で、、　とりあえず推奨の通り　なんか違うと思うが。。
- 属性変更の確認　ここもとりあえず推奨で
- ユーザー作成時の必須の属性を選択 まあとりあえずemailのみ
- 次にステップ４　メッセージ配信の設定
- Eメールプロバイダー　とりあえずCognitoからで
- 送信元アドレスもデフォルトで次へ
- 次はステップ５　アプリケーションの統合
- ユーザープール名の設定　をする
- ホストされた認証ページ　これって必要？　必要そうな気がするが、、　後で調べる
- 最初のアプリケーションクライアント　パブリッククライアント　で　アプリケーションクライアント名を入力
- クライアントシークレットを生成しない　を設定
- で次へ
- 最後ステップ６確認及び作成
- でユーザープールのお作成　へ
- でユーザープールが作成される

- ユーザープールが作成されたら　アプリケーションの統合＞アプリクライアントと分析＞アプリケーションクライアント名
- ホストされたUI　で編集
- IDプロバイダー　でCognitoユーザープールを選択
- "コールバック URL"、"サインアウト URL" を HTTPS で設定する。ここではコールバックURLは S3 バケットにある index.html の オブジェクト URL 、サインアウトURLはgoogleなどを入れる。
- OAuth2.0許可タイプ　は暗黙的な付与
- OpenID接続スコープ　はOpenIDを入れる
- で変更の保存
！（S3の静的webホスティングでHTTPS化しておく必要がある！！）

- アプリケーションの統合＞ドメイン名　でCognitoドメインの作成　をすっる、名前も入力するr


